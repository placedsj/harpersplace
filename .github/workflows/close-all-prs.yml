name: Close All Open Pull Requests

on:
  workflow_dispatch:
  push:
    branches:
      - 'copilot/close-all-pull-requests-again'

jobs:
  close-prs:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Close all open pull requests
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          CURRENT_PR=82
          echo "Fetching all open pull requests..."
          gh pr list --repo placedsj/harpersplace --state open --json number --limit 100 \
            | jq -r '.[].number' \
            | while read pr; do
                if [ "$pr" -eq "$CURRENT_PR" ]; then
                  echo "Skipping current PR #$pr"
                else
                  echo "Closing PR #$pr..."
                  gh pr close "$pr" --repo placedsj/harpersplace --comment "Closing as requested by repository owner."
                fi
              done
          echo "Done."
